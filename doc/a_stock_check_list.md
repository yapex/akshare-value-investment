# AI Agent 财报检查执行说明

## 概述

本说明旨在为 AI Agent 提供详细的操作指引，使其能够基于 A 股财务数据字段和 API 查询接口，逐项完成对公司的财务检查，并生成分析结果。

## 基础配置

### API 端点
- **数据查询**: `POST /api/v1/financial/query`
- **字段发现**:
  - 财务指标: `GET /api/v1/financial/fields/a_stock/a_stock_indicators`
  - 资产负债表: `GET /api/v1/financial/fields/a_stock/a_stock_balance_sheet`
  - 利润表: `GET /api/v1/financial/fields/a_stock/a_stock_income_statement`
  - 现金流量表: `GET /api/v1/financial/fields/a_stock/a_stock_cash_flow`

### API 请求格式
```json
{
  "market": "a_stock",
  "query_type": "a_stock_balance_sheet",  // 或 a_stock_income_statement, a_stock_cash_flow, a_stock_indicators
  "fields": ["字段1", "字段2", ...],
  "filter": {
    "symbol": "股票代码",
    "report_period": "报告期"  // 可选，如 "2024-09-30"
  }
}
```

## 执行流程

### 第一步：API健康检查
在开始任何财务数据分析之前，AI Agent必须首先验证API服务的可用性：
1. 检查API服务器是否运行：`GET /health`
   - 请求示例: `curl -s http://localhost:8000/health`
   - 预期响应: `{"status":"healthy","container":"initialized","service":"akshare-value-investment-api",...}`
   - 验证服务状态为"healthy"
2. 确认API服务状态为healthy

### 第二步：数据准备
1. 根据待检查公司识别其股票代码
2. 检索最新报告期的财务数据
3. 准备多个报告期的数据（用于增长率等需要历史数据的分析）

### 第三步：逐项检查
按照财报检查清单的顺序，逐项执行分析。

### 第四步：结果汇总
汇总所有可量化和无法量化的项目结果，生成综合分析报告。

## 逐项检查指导

### 一、资产负债表检查

#### 1.1.1 货币资金是否安全？
- **状态**: ✅ **可量化**
- **API 查询**:
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_balance_sheet",
    "fields": ["货币资金", "交易性金融资产", "总现金", "短期借款", "长期借款"],
    "filter": {"symbol": "股票代码"}
  }
  ```
- **计算**: 
  - 货币资金安全比率 = (`货币资金` + `交易性金融资产`) ÷ (`短期借款` + `长期借款`) × 100%
  - 总覆盖率 = (`货币资金` + `交易性金融资产` + `总现金`) ÷ (`短期借款` + `长期借款`) × 100%
- **分析结果格式**: "公司货币资金安全比率为X%，总覆盖率为Y%，说明..."

#### 1.1.2 货币资金是否存在异常？
- **状态**: ✅ **可量化**
- **API 查询**:
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_balance_sheet",
    "fields": ["货币资金", "短期借款", "长期借款"],
    "filter": {"symbol": "股票代码"}
  }
  ```
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_income_statement",
    "fields": ["利息收入"],
    "filter": {"symbol": "股票代码"}
  }
  ```
- **计算**:
  - 资金覆盖度 = `货币资金` ÷ `短期借款` × 100%
  - 估算利率 = `利息收入` ÷ `货币资金` × 100%
  - 资金负债比 = `货币资金` ÷ (`短期借款` + `长期借款`) × 100%
- **分析结果格式**: "公司资金覆盖度为X%，估算利率为Y%，资金负债比为Z%，说明..."

#### 1.1.3 应收票据是否健康？
- **状态**: ❌ **无法量化**
- **分析结果格式**: "无法量化。虽然有`应收票据及应收账款`和`其中：应收票据`字段，但缺少区分商业承兑汇票和银行承兑汇票的详细信息，无法判断商票占比是否过高。"

#### 1.1.4 应收账款是否健康？
- **状态**: ✅ **可量化**
- **API 查询**:
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_balance_sheet",
    "fields": ["应收账款", "其他应收款", "资产合计"],
    "filter": {"symbol": "股票代码"}
  }
  ```
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_income_statement",
    "fields": ["营业收入"],
    "filter": {"symbol": "股票代码"}
  }
  ```
- **计算**:
  - 应收账款占总资产比例 = (`应收账款` + `其他应收款`) ÷ `资产合计` × 100%
  - 应收账款周转率 = `营业收入` ÷ (`应收账款` + `其他应收款`) × 2
- **分析结果格式**: "公司应收账款占总资产比例为X%，应收账款周转率为Y次，说明..."

#### 1.1.5 预付账款是否异常？
- **状态**: ❌ **无法量化**
- **分析结果格式**: "无法量化。虽然有`预付款项`字段，但缺少历史对比和行业对比数据，无法判断是否大幅增长或长期挂账。"

#### 1.1.6 其他应收款是否异常？
- **状态**: ✅ **可量化**（部分量化）
- **API 查询**:
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_balance_sheet",
    "fields": ["其他应收款", "资产合计"],
    "filter": {"symbol": "股票代码"}
  }
  ```
- **计算**: 其他应收款占比 = `其他应收款` ÷ `资产合计` × 100%
- **分析结果格式**: "公司其他应收款占比为X%，说明..."

#### 1.1.7 坏账准备计提是否合理？
- **状态**: ✅ **可量化**（替代方案）
- **API 查询**:
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_balance_sheet",
    "fields": ["应收账款", "其他应收款"],
    "filter": {"symbol": "股票代码"}
  }
  ```
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_income_statement",
    "fields": ["资产减值损失", "信用减值损失"],
    "filter": {"symbol": "股票代码"}
  }
  ```
- **计算**: 坏账准备比率 = (`资产减值损失` + `信用减值损失`) ÷ (`应收账款` + `其他应收款`) × 100%
- **分析结果格式**: "公司坏账准备比率为X%，说明..."

#### 1.1.8 存货是否存在风险？
- **状态**: ✅ **可量化**
- **API 查询**:
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_balance_sheet",
    "fields": ["存货"],
    "filter": {"symbol": "股票代码"}
  }
  ```
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_income_statement",
    "fields": ["营业成本"],
    "filter": {"symbol": "股票代码"}
  }
  ```
- **计算**: 存货周转率 = `营业成本` ÷ `存货` × 2
- **分析结果格式**: "公司存货周转率为X次，说明..."

#### 1.1.9 公司是否属于财务造假高危领域？
- **状态**: ❌ **无法量化**
- **分析结果格式**: "无法量化。这是一个定性判断，需要行业分类和业务模式分析，无法通过财务数据直接量化。"

#### 1.1.10 长期股权投资是否存在操纵迹象？
- **状态**: ❌ **无法量化**
- **分析结果格式**: "无法量化。需要具体交易细节和关联方信息，仅靠财务报表数据难以判断是否存在操纵迹象。"

#### 1.1.11 投资性房地产的计量模式是什么？
- **状态**: ❌ **无法量化**
- **分析结果格式**: "无法量化。会计政策信息在报表附注中说明，无法通过数值字段直接判断计量模式。"

#### 1.1.12 固定资产折旧政策是否变更？
- **状态**: ❌ **无法量化**
- **API 查询**:
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_balance_sheet",
    "fields": ["固定资产合计"],
    "filter": {"symbol": "股票代码"}
  }
  ```
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_income_statement",
    "fields": ["营业收入"],
    "filter": {"symbol": "股票代码"}
  }
  ```
- **计算**: 固定资产周转率 = `营业收入` ÷ `固定资产合计` × 100%
- **分析结果格式**: "无法量化。会计政策变更信息在报表附注中，且字段中缺少固定资产净值（原值-累计折旧）相关信息，无法准确计算周转率。但固定资产周转率为X次。"

#### 1.1.13 在建工程是否异常？
- **状态**: ✅ **可量化**（部分量化）
- **API 查询**:
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_balance_sheet",
    "fields": ["在建工程合计", "资产合计"],
    "filter": {"symbol": "股票代码"}
  }
  ```
- **计算**: 在建工程占比 = `在建工程合计` ÷ `资产合计` × 100%
- **分析结果格式**: "公司再建工程占比为X%，说明..."

#### 1.1.14 开发支出资本化是否合理？
- **状态**: ❌ **无法量化**
- **分析结果格式**: "无法量化。"开发支出"字段未在资产负债表字段清单中找到，可能归类在"其他非流动资产"中，无法直接量化评估其合理性。"

#### 1.1.15 商誉是否过大？
- **状态**: ❌ **无法量化**
- **API 查询**:
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_balance_sheet",
    "fields": ["负债合计", "资产合计"],
    "filter": {"symbol": "股票代码"}
  }
  ```
- **分析结果格式**: "无法量化。"商誉"字段未在资产负债表字段清单中找到，可能包含在"其他非流动资产"中，无法直接计算调整后负债率。"

#### 1.1.16 长期待摊费用数额是否过大？
- **状态**: ✅ **可量化**
- **API 查询**:
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_balance_sheet",
    "fields": ["长期待摊费用", "资产合计"],
    "filter": {"symbol": "股票代码"}
  }
  ```
- **计算**: 长期待摊费用占比 = `长期待摊费用` ÷ `资产合计` × 100%
- **分析结果格式**: "公司长期待摊费用占比为X%，说明..."

### 1.2 负债与权益类项目

#### 1.2.1 有息负债占比及成本如何？
- **状态**: ✅ **可量化**
- **API 查询**:
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_balance_sheet",
    "fields": ["短期借款", "长期借款", "资产合计", "负债合计"],
    "filter": {"symbol": "股票代码"}
  }
  ```
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_income_statement",
    "fields": ["财务费用"],
    "filter": {"symbol": "股票代码"}
  }
  ```
- **计算**:
  - 有息负债占比 = (`短期借款` + `长期借款`) ÷ `资产合计` × 100%
  - 资产负债率 = `负债合计` ÷ `资产合计` × 100%
  - 借款利率 = `财务费用` ÷ (`短期借款` + `长期借款`) × 100%
- **分析结果格式**: "公司有息负债占比为X%，资产负债率为Y%，借款利率为Z%，说明..."

#### 1.2.2 应付账款/票据是否异常大增？
- **状态**: ✅ **可量化**（部分量化）
- **API 查询**:
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_balance_sheet",
    "fields": ["应付账款", "应付票据及应付账款", "负债合计"],
    "filter": {"symbol": "股票代码"}
  }
  ```
- **计算**:
  - 应付账款占比 = `应付账款` ÷ `负债合计` × 100%
  - 应付票据及账款占比 = `应付票据及应付账款` ÷ `负债合计` × 100%
- **分析结果格式**: "公司应付账款占比为X%，应付票据及账款占比为Y%，说明..."

#### 1.2.3 预收款项数额是否略高？
- **状态**: ✅ **可量化**（部分量化）
- **API 查询**:
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_balance_sheet",
    "fields": ["预收款项", "负债合计"],
    "filter": {"symbol": "股票代码"}
  }
  ```
- **计算**: 预收账款占比 = `预收款项` ÷ `负债合计` × 100%
- **分析结果格式**: "公司预收账款占比为X%，说明..."

#### 1.2.4 应付职工薪酬是否透露关键信息？
- **状态**: ❌ **无法量化**
- **API 查询**:
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_balance_sheet",
    "fields": ["减：库存股"],
    "filter": {"symbol": "股票代码"}
  }
  ```
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_income_statement",
    "fields": ["营业收入"],
    "filter": {"symbol": "股票代码"}
  }
  ```
- **计算**: 员工薪酬占比 = `应付职工薪酬` ÷ `营业收入` × 100%
- **分析结果格式**: "无法量化。虽然有`应付职工薪酬`字段，但缺少员工总数和薪酬历史数据，无法进行详细分析。员工薪酬占比为X%。"

#### 1.2.5 有无隐藏的良性债务？
- **状态**: ✅ **可量化**
- **API 查询**:
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_balance_sheet",
    "fields": ["专项应付款", "负债合计"],
    "filter": {"symbol": "股票代码"}
  }
  ```
- **计算**: 专项应付款占比 = `专项应付款` ÷ `负债合计` × 100%
- **分析结果格式**: "公司专项应付款占比为X%，说明..."

#### 1.2.6 库存股回购的目的是什么？
- **状态**: ✅ **可量化**
- **API 查询**:
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_balance_sheet",
    "fields": ["减：库存股", "资产合计"],
    "filter": {"symbol": "股票代码"}
  }
  ```
- **计算**: 库存股占比 = `减：库存股` ÷ `资产合计` × 100%
- **分析结果格式**: "公司库存股占比为X%，说明..."

### 1.3 整体分析指标

#### 1.3.1 公司成长性与营运能力如何？
- **状态**: ✅ **可量化**
- **API 查询**:
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_balance_sheet",
    "fields": ["资产合计"],
    "filter": {"symbol": "股票代码"}
  }
  ```
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_income_statement",
    "fields": ["营业收入"],
    "filter": {"symbol": "股票代码"}
  }
  ```
- **计算**: 总资产周转率 = `营业收入` ÷ `资产合计` × 2
- **分析结果格式**: "公司总资产周转率为X次，说明..."

## 二、利润表检查

#### 2.1 主营业务是否聚焦？
- **状态**: ❌ **无法量化**
- **分析结果格式**: "无法量化。需要业务分部信息和收入构成明细，现有利润表字段中只有总体收入类别，无法判断主营业务是否聚焦。"

#### 2.2 营业收入增长是否健康？
- **状态**: ✅ **可量化**
- **API 查询**:
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_income_statement",
    "symbol": "股票代码",
    "fields": ["其中：营业收入"],
    "frequency": "annual"
  }
  ```
- **计算**:
  - 近5年营业收入增长率分析 = (最新年份营业收入 - 5年前营业收入) ÷ 5年前营业收入 × 100%
  - 年复合增长率(CAGR) = (最新年份营业收入 ÷ 5年前营业收入)^(1/5) - 1
  - 同比增长率 = (`本年营业收入` - `上年营业收入`) ÷ `上年营业收入` × 100%
  - 增长稳定性：分析5年数据的波动性和趋势
- **分析结果格式**: "公司近5年营业收入年复合增长率为X%，2024年同比增长Y%，增长趋势[稳定/波动/上升/下降]，说明..."
- **数据要求**：获取最近5-6年的营业收入数据，确保有足够的历史数据进行趋势分析
- **评估标准**：
  - 优秀：年复合增长率>15%，增长稳定
  - 良好：年复合增长率10-15%，增长相对稳定
  - 一般：年复合增长率5-10%，存在一定波动
  - 较差：年复合增长率<5%或负增长，波动较大

#### 2.3 有无可疑的收入或关联交易？
- **状态**: ❌ **无法量化**
- **分析结果格式**: "无法量化。关联交易信息在报表附注中详细披露，仅凭利润表数据无法判断交易的可疑性。"

#### 2.4 毛利率是否异常？
- **状态**: ✅ **可量化**
- **API 查询**:
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_income_statement",
    "fields": ["营业收入", "营业成本"],
    "filter": {"symbol": "股票代码"}
  }
  ```
- **计算**: 毛利率 = (`营业收入` - `营业成本`) ÷ `营业收入` × 100%
- **分析结果格式**: "公司毛利率为X%，说明..."

#### 2.5 费用控制是否有效？
- **状态**: ✅ **可量化**
- **API 查询**:
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_income_statement",
    "fields": ["营业收入", "营业成本", "销售费用", "管理费用", "财务费用", "研发费用"],
    "filter": {"symbol": "股票代码"}
  }
  ```
- **计算**:
  - 销售费用率 = `销售费用` ÷ `营业收入` × 100%
  - 管理费用率 = `管理费用` ÷ `营业收入` × 100%
  - 财务费用率 = `财务费用` ÷ `营业收入` × 100%
  - 三费占营收比 = (`销售费用` + `管理费用` + `财务费用`) ÷ `营业收入` × 100%
  - 研发费用占比 = `研发费用` ÷ `营业收入` × 100%
- **分析结果格式**: "公司销售费用率为X%，管理费用率为Y%，财务费用率为Z%，三费占营收比为A%，研发费用占比为B%，说明..."

#### 2.6 资产减值损失有无操纵痕迹？
- **状态**: ✅ **可量化**（部分量化）
- **API 查询**:
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_income_statement",
    "fields": ["资产减值损失", "信用减值损失", "营业收入"],
    "filter": {"symbol": "股票代码"}
  }
  ```
- **计算**: 资产减值影响 = (`资产减值损失` + `信用减值损失`) ÷ `营业收入` × 100%
- **分析结果格式**: "公司资产减值影响为X%，说明..."

#### 2.7 营业利润增长质量如何？
- **状态**: ✅ **可量化**
- **API 查询**:
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_income_statement",
    "symbol": "股票代码",
    "fields": ["三、营业利润", "其中：营业收入"],
    "frequency": "annual"
  }
  ```
- **计算**:
  - 近5年营业利润增长率分析 = (最新年份营业利润 - 5年前营业利润) ÷ 5年前营业利润 × 100%
  - 年复合增长率(CAGR) = (最新年份营业利润 ÷ 5年前营业利润)^(1/5) - 1
  - 同比增长率 = (`本年营业利润` - `上年营业利润`) ÷ `上年营业利润` × 100%
  - 营业利润率 = `营业利润` ÷ `营业收入` × 100%
  - 增长质量评估：对比营业利润增长率与营业收入增长率，分析盈利能力的提升质量
- **分析结果格式**: "公司近5年营业利润年复合增长率为X%，2024年同比增长Y%，营业利润率为Z%，增长质量[优秀/良好/一般/较差]，说明..."
- **数据要求**：获取最近5-6年的营业利润和营业收入数据
- **质量评估标准**：
  - 优秀：营业利润增长率>营业收入增长率，利润率稳定提升
  - 良好：营业利润增长率与营业收入增长率基本匹配
  - 一般：营业利润增长率低于营业收入增长率但为正
  - 较差：营业利润增长率大幅低于营业收入增长率或为负

#### 2.8 其他收益是否可靠？
- **状态**: ✅ **可量化**（部分量化）
- **API 查询**:
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_income_statement",
    "fields": ["营业外收入", "营业外支出", "其他收益", "净利润", "营业收入"],
    "filter": {"symbol": "股票代码"}
  }
  ```
- **计算**:
  - 营业外净收入 = `营业外收入` - `营业外支出`
  - 营业外收入占比 = `营业外收入` ÷ `净利润` × 100%
  - 其他收益占比 = `其他收益` ÷ `营业收入` × 100%
- **分析结果格式**: "公司营业外净收入为X元，营业外收入占比为Y%，其他收益占比为Z%，说明..."

#### 2.9 净利润含金量高吗？
- **状态**: ✅ **可量化**
- **API 查询**:
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_income_statement",
    "fields": ["净利润"],
    "filter": {"symbol": "股票代码"}
  }
  ```
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_cash_flow",
    "fields": ["经营活动产生的现金流量净额"],
    "filter": {"symbol": "股票代码"}
  }
  ```
- **计算**: 净利润含金量 = `经营活动产生的现金流量净额` ÷ `净利润` × 100%
- **分析结果格式**: "公司净利润含金量为X%，说明..."

#### 2.10 核心收益率指标如何？
- **状态**: ✅ **可量化**
- **API 查询**:
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_income_statement",
    "fields": ["净利润"],
    "filter": {"symbol": "股票代码"}
  }
  ```
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_balance_sheet",
    "fields": ["归属于母公司所有者权益合计", "资产合计"],
    "filter": {"symbol": "股票代码"}
  }
  ```
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_indicators",
    "fields": ["净资产收益率", "净资产收益率-摊薄"],
    "filter": {"symbol": "股票代码"}
  }
  ```
- **计算**:
  - 净资产收益率(ROE) = `净利润` ÷ `归属于母公司所有者权益合计` × 100%
  - 总资产收益率(ROA) = `净利润` ÷ `资产合计` × 100%
- **分析结果格式**: "公司净资产收益率为X%，总资产收益率为Y%，财务指标表直接提供净资产收益率为Z%，说明..."

#### 2.11 公司属于重资产还是轻资产？
- **状态**: ✅ **可量化**（部分量化）
- **API 查询**:
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_balance_sheet",
    "fields": ["固定资产合计", "在建工程合计", "工程物资", "无形资产", "资产合计"],
    "filter": {"symbol": "股票代码"}
  }
  ```
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_income_statement",
    "fields": ["利润总额"],
    "filter": {"symbol": "股票代码"}
  }
  ```
- **计算**:
  - 生产资产占比 = (`固定资产合计` + `在建工程合计` + `工程物资` + `无形资产`) ÷ `资产合计` × 100%
  - 生产资产回报率 = `利润总额` ÷ (`固定资产合计` + `在建工程合计` + `工程物资` + `无形资产`) × 100%
- **分析结果格式**: "公司生产资产占比为X%，生产资产回报率为Y%，说明..."

## 三、现金流量表检查

#### 3.1 经营活动现金流是否优秀？
- **状态**: ✅ **可量化**
- **API 查询**:
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_cash_flow",
    "fields": ["经营活动产生的现金流量净额"],
    "filter": {"symbol": "股票代码"}
  }
  ```
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_income_statement",
    "fields": ["净利润", "固定资产折旧、油气资产折耗、生产性生物资产折旧", "无形资产摊销", "长期待摊费用摊销"],
    "filter": {"symbol": "股票代码"}
  }
  ```
- **计算**:
  - 经营现金流健康度 = `经营活动产生的现金流量净额` ÷ `净利润` × 100%
  - 经营现金流与净利润比 = `经营活动产生的现金流量净额` ÷ (`净利润` + `固定资产折旧、油气资产折耗、生产性生物资产折旧` + `无形资产摊销` + `长期待摊费用摊销`)
- **分析结果格式**: "公司经营现金流健康度为X%，经营现金流与净利润比为Y，说明..."

#### 3.2 投资活动现金流是否健康？
- **状态**: ✅ **可量化**
- **API 查询**:
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_cash_flow",
    "fields": ["投资活动产生的现金流量净额"],
    "filter": {"symbol": "股票代码"}
  }
  ```
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_income_statement",
    "fields": ["投资收益"],
    "filter": {"symbol": "股票代码"}
  }
  ```
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_cash_flow",
    "fields": ["取得投资收益收到的现金"],
    "filter": {"symbol": "股票代码"}
  }
  ```
- **计算**: 投资回报率 = (`投资收益` + `取得投资收益收到的现金`) ÷ |`投资活动产生的现金流量净额`| × 100%
- **分析结果格式**: "公司投资活动净现金流为X元，投资回报率为Y%，说明..."

#### 3.3 筹资活动现金流是否异常？
- **状态**: ✅ **可量化**（部分量化）
- **API 查询**:
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_cash_flow",
    "fields": ["筹资活动产生的现金流量净额"],
    "filter": {"symbol": "股票代码"}
  }
  ```
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_cash_flow",
    "fields": ["分配股利、利润或偿付利息支付的现金"],
    "filter": {"symbol": "股票代码"}
  }
  ```
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_balance_sheet",
    "fields": ["短期借款", "长期借款"],
    "filter": {"symbol": "股票代码"}
  }
  ```
- **计算**: 借款利率 = `分配股利、利润或偿付利息支付的现金` ÷ (`短期借款` + `长期借款`) × 100%
- **分析结果格式**: "公司筹资活动净现金流为X元，借款利率为Y%，说明..."

#### 3.4 公司整体现金流类型是什么？
- **状态**: ✅ **可量化**
- **API 查询**:
  ```json
  {
    "market": "a_stock",
    "query_type": "a_stock_cash_flow",
    "fields": ["经营活动产生的现金流量净额", "投资活动产生的现金流量净额", "筹资活动产生的现金流量净额"],
    "filter": {"symbol": "股票代码"}
  }
  ```
- **判断标准**:
  - "正负负"型：`经营活动产生的现金流量净额` > 0 且 `投资活动产生的现金流量净额` < 0 且 `筹资活动产生的现金流量净额` < 0
  - "正正负"型：`经营活动产生的现金流量净额` > 0 且 `投资活动产生的现金流量净额` > 0 且 `筹资活动产生的现金流量净额` < 0
- **分析结果格式**: "公司现金流类型为XX型，说明..."

## 输出格式示例

### 完整分析报告模板

```
# {公司名称} 财报分析报告

## 分析概要
- 分析日期: {YYYY-MM-DD}
- 股票代码: {股票代码}
- 报告期: {报告期}

## 逐项分析结果

### 一、资产负债表分析
1. 货币资金安全检查：[emoji结论]
{详细说明，不重复计算公式，重点关注业务含义和分析}
2. 货币资金异常检查：[emoji结论]
{详细说明，不重复计算公式，重点关注业务含义和分析}
3. 应收票据健康检查：[emoji结论]
{详细说明，不重复计算公式，重点关注业务含义和分析}
...

### 二、利润表分析
1. 主营业务聚焦检查：[emoji结论]
{详细说明，不重复计算公式，重点关注业务含义和分析}
2. 营业收入增长检查：[emoji结论]
{详细说明，不重复计算公式，重点关注业务含义和分析}
...

### 三、现金流量表分析
1. 经营活动现金流检查：[emoji结论]
{详细说明，不重复计算公式，重点关注业务含义和分析}
...

## 综合评价
- 财务状况：{总体评价}
- 关注点：{主要风险点}
- 优点：{主要优势}
```

### 输出格式要求

对于每一项财务指标分析，应采用以下格式：

**格式**：[emoji结论] \n{详细说明部分（包括计算过程）}

**说明**：
- 结论部分用最少字数输出，直接使用emoji表情完成
- 详细说明部分不能丢，但要避免重复计算公式（计算公式已在原始数据计算过程部分列出）
- 详细说明部分应重点关注业务含义、行业背景和趋势分析
- 每项分析以结论开头，换行后加上详细说明部分
- **【重要】**对于所有可计算项，在详细说明部分的最后，必须单独列出"**原始数据计算过程**"，格式如下：
  ```
  原始数据计算过程：
  - 计算公式：[具体计算公式]
  - 计算过程：[具体数据代入计算过程]
  - 计算结果：[具体数值]
  ```
- Emoji建议：
  - ✅ 表示良好/正常/无异常
  - ⚠️ 表示存在风险/需关注
  - ❗ 表示严重问题
  - 💎 表示优秀/卓越
  - 📊 表示数据相关
  - 🏗️ 表示重资产相关
  - 📈 表示增长相关
  - 📉 表示下降/负向
  - ❓ 表示无法量化/不确定
  - 📋 表示中性结果

### 原始数据计算过程示例

#### 示例1：货币资金安全比率
```
原始数据计算过程：
- 计算公式：(货币资金 + 交易性金融资产) ÷ (短期借款 + 长期借款) × 100%
- 计算过程：(4.64亿 + 1.69亿) ÷ (6005.07万 + 11.64亿) × 100%
- 计算结果：51.7%
```

#### 示例2：毛利率
```
原始数据计算过程：
- 计算公式：(营业收入 - 营业成本) ÷ 营业收入 × 100%
- 计算过程：(13.19亿 - 8.96亿) ÷ 13.19亿 × 100%
- 计算结果：32.1%
```

#### 示例3：净利润含金量
```
原始数据计算过程：
- 计算公式：经营活动产生的现金流量净额 ÷ 归属于母公司所有者的净利润 × 100%
- 计算过程：4.07亿 ÷ 7088.25万 × 100%
- 计算结果：574.6%
```

### 计算过程格式规范

1. **数据来源标注**：每个数据字段必须明确标注来源报表类型
2. **单位统一**：计算过程中保持金额单位一致（亿/万）
3. **公式位置**：计算公式仅在"原始数据计算过程"部分列出，不要在详细说明部分重复
4. **结果精确**：计算结果保留一位小数（百分比）
5. **分步展示**：复杂计算需要分步展示中间结果
6. **详细说明重点**：详细说明部分应重点关注业务含义、行业背景和趋势分析，而不是重复计算公式

## API健康检查补充说明

在开始任何财务数据分析之前，AI Agent必须首先验证API服务的可用性：

### 1. 健康检查
- **端点**: `GET /health`
- **目的**: 验证API服务是否正常运行
- **成功标志**: 返回状态为"healthy"
- **请求示例**:
  ```bash
  curl -s http://localhost:8000/health
  ```
- **预期响应**:
  ```json
  {
    "status": "healthy",
    "container": "initialized",
    "service": "akshare-value-investment-api",
    "services": {
      "a_stock_indicators": "available",
      "hk_stock_indicators": "available",
      "us_stock_indicators": "available"
    }
  }
  ```

### 2. 字段发现端点验证
- **端点**: `GET /api/v1/financial/fields/{market}/{query_type}`
- **目的**: 验证可以成功获取指定市场和查询类型的可用字段列表
- **验证方法**: 尝试获取一个已知的字段列表，确认返回成功
- **示例**:
  ```bash
  curl -s "http://localhost:8000/api/v1/financial/fields/a_stock/a_stock_balance_sheet"
  ```

### 3. 数据查询端点验证
- **端点**: `POST /api/v1/financial/query`
- **目的**: 验证可以成功查询财务数据
- **验证方法**: 使用一个已知的股票代码进行简单查询测试
- **示例请求**:
```json
{
  "market": "a_stock",
  "query_type": "a_stock_balance_sheet",
  "symbol": "000001",  // 使用一个已知的股票代码进行测试
  "fields": ["货币资金"],
  "frequency": "annual"
}
```

### 4. 错误处理
- 如果API健康检查失败，AI Agent应停止执行并报告错误
- 记录错误信息，包括HTTP状态码和错误消息
- 提供可能的解决方案（如重启API服务或检查网络连接）

### 5. 服务可用性确认
- 确认所有必需的API端点都可用
- 验证API响应时间在可接受范围内
- 确认返回的数据格式符合预期

## 注意事项

1. **数据验证**：每次查询后验证数据是否有效，避免因数据缺失导致计算错误。
2. **多期数据**：对于需要历史对比的指标，获取多期数据进行分析。
3. **异常值处理**：当分母为0或负数时，避免除零错误，提供适当说明。
4. **结果解释**：数值结果应结合行业背景和公司实际情况进行合理解释。
5. **无法量化项目**：对于无法量化的项目，明确说明原因但可提供定性分析。

## 更新历史

### 2025-12-11 历史数据分析策略优化
- **营业收入增长分析**：从单年度同比增长改进为近5年复合增长率分析，增加增长稳定性评估
  - 新增年复合增长率(CAGR)计算
  - 新增增长轨迹和波动性分析
  - 建立四级评估标准(优秀/良好/一般/较差)

- **营业利润增长质量分析**：从单年度对比改进为多维度质量评估
  - 新增营业利润与营业收入增长率对比
  - 新增增长质量评估标准
  - 增强盈利稳定性分析

- **数据要求标准化**：
  - 明确要求获取最近5-6年历史数据
  - 统一API查询格式(frequency: "annual")
  - 规范字段名称使用

### 分析效果提升
通过历史数据分析策略的优化，能够更准确地评估：
1. **增长趋势的稳定性**：避免单年度数据的偶然性影响
2. **盈利质量的真实性**：通过复合增长率识别异常波动
3. **投资价值的持续性**：长期趋势比短期波动更有参考价值

### 实际应用案例
以分众传媒(002023)为例：
- **营业收入**：从单年波动描述升级为"5年复合增长率10.3%，波动上升趋势"
- **营业利润**：从简单波动描述升级为"5年复合增长率2.3%，增长质量较差"
- **分析深度**：提供了明确的增长轨迹和质量评估结论