<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´¢åŠ¡æ•°æ®æŸ¥è¯¢ API æµ‹è¯•å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        .header {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            text-align: center;
        }
        .header h1 {
            color: #333;
            font-size: 28px;
            margin-bottom: 10px;
        }
        .header p {
            color: #666;
            font-size: 14px;
        }
        .tabs {
            display: flex;
            background: white;
            border-radius: 12px 12px 0 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-bottom: 0;
        }
        .tab {
            flex: 1;
            padding: 15px 20px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            color: #666;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        .tab:hover {
            background: #e9ecef;
        }
        .tab.active {
            background: white;
            color: #667eea;
            border-bottom-color: #667eea;
        }
        .tab-content {
            background: white;
            padding: 30px;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }
        .form-group select,
        .form-group input[type="text"],
        .form-group input[type="number"] {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }
        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        .method-badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 10px;
        }
        .url-display {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 12px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #495057;
            word-break: break-all;
        }
        .url-display strong {
            color: #333;
        }
        button[type="submit"] {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        button[type="submit"]:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        button[type="submit"]:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            display: none;
        }
        .result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
        }
        .result.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
        }
        .result h2 {
            margin-bottom: 15px;
            font-size: 18px;
        }
        .result.success h2 {
            color: #155724;
        }
        .result.error h2 {
            color: #721c24;
        }
        .metadata {
            background: white;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        .metadata h3 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 16px;
        }
        .metadata p {
            margin: 5px 0;
            color: #555;
            font-size: 14px;
        }
        .metadata strong {
            color: #333;
        }
        pre {
            background: #f4f4f4;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 12px;
            line-height: 1.5;
            max-height: 400px;
            overflow-y: auto;
        }
        .loading {
            text-align: center;
            color: #667eea;
            padding: 20px;
            font-size: 16px;
            display: none;
        }
        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
        .field-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 8px;
            margin-top: 10px;
        }
        .field-item {
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            color: #495057;
            border-left: 3px solid #667eea;
        }

        /* è¡¨æ ¼æ ·å¼ */
        .table-container {
            overflow-x: auto;
            margin: 15px 0;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            font-size: 13px;
        }
        .data-table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .data-table th {
            padding: 12px 10px;
            text-align: left;
            font-weight: 600;
            white-space: nowrap;
            border-right: 1px solid rgba(255,255,255,0.2);
        }
        .data-table th:last-child {
            border-right: none;
        }
        .data-table tbody tr {
            border-bottom: 1px solid #e9ecef;
            transition: background-color 0.2s;
        }
        .data-table tbody tr:hover {
            background-color: #f8f9fa;
        }
        .data-table tbody tr:last-child {
            border-bottom: none;
        }
        .data-table td {
            padding: 10px;
            color: #495057;
            border-right: 1px solid #e9ecef;
        }
        .data-table td:last-child {
            border-right: none;
        }
        .data-table td:first-child {
            font-weight: 500;
            color: #333;
        }
        .no-data {
            text-align: center;
            padding: 20px;
            color: #6c757d;
            background: #f8f9fa;
            border-radius: 6px;
            margin: 15px 0;
        }
        .raw-data {
            margin-top: 20px;
            background: white;
            border-radius: 6px;
            padding: 10px;
        }
        .raw-data summary {
            cursor: pointer;
            padding: 10px;
            font-weight: 600;
            color: #667eea;
            user-select: none;
        }
        .raw-data summary:hover {
            color: #764ba2;
        }
        .raw-data pre {
            margin-top: 10px;
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ è´¢åŠ¡æ•°æ®æŸ¥è¯¢ API æµ‹è¯•å·¥å…·</h1>
            <p>FastAPI Web API å…¨æ¥å£æµ‹è¯• - æ”¯æŒ GET/POST æ–¹æ³•</p>
        </div>

        <!-- Tab å¯¼èˆª -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('indicators')" id="tabIndicators">
                ğŸ“Š è´¢åŠ¡æŒ‡æ ‡æŸ¥è¯¢
            </button>
            <button class="tab" onclick="switchTab('statements')" id="tabStatements">
                ğŸ“‹ è´¢åŠ¡ä¸‰è¡¨æŸ¥è¯¢
            </button>
            <button class="tab" onclick="switchTab('fields')" id="tabFields">
                ğŸ” å­—æ®µå‘ç°
            </button>
        </div>

        <!-- è´¢åŠ¡æŒ‡æ ‡æŸ¥è¯¢ -->
        <div class="tab-content" id="contentIndicators">
            <h2 style="margin-bottom: 20px; color: #333;">
                è´¢åŠ¡æŒ‡æ ‡æŸ¥è¯¢
                <span class="method-badge">GET /indicators</span>
            </h2>

            <form id="indicatorsForm">
                <div class="form-group">
                    <label for="indicators_market">å¸‚åœºç±»å‹</label>
                    <select id="indicators_market" name="market" required onchange="updateIndicatorsSymbol()">
                        <option value="a_stock">Aè‚¡</option>
                        <option value="hk_stock">æ¸¯è‚¡</option>
                        <option value="us_stock">ç¾è‚¡</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="indicators_symbol">è‚¡ç¥¨ä»£ç </label>
                    <input type="text" id="indicators_symbol" name="symbol" value="SH600519" placeholder="ä¾‹å¦‚: SH600519, 00700, AAPL" required>
                </div>

                <div class="form-group">
                    <label for="indicators_frequency">æ•°æ®é¢‘ç‡</label>
                    <select id="indicators_frequency" name="frequency" required>
                        <option value="annual">å¹´åº¦æ•°æ®</option>
                        <option value="quarterly">æŠ¥å‘ŠæœŸæ•°æ®</option>
                    </select>
                </div>

                <button type="submit" id="indicatorsSubmitBtn">ğŸ” æŸ¥è¯¢è´¢åŠ¡æŒ‡æ ‡</button>
            </form>

            <div class="url-display" id="indicatorsUrl">
                <strong>è¯·æ±‚ URLï¼š</strong><span id="indicatorsUrlText">-</span>
            </div>
        </div>

        <!-- è´¢åŠ¡ä¸‰è¡¨æŸ¥è¯¢ -->
        <div class="tab-content" id="contentStatements" style="display: none;">
            <h2 style="margin-bottom: 20px; color: #333;">
                è´¢åŠ¡ä¸‰è¡¨èšåˆæŸ¥è¯¢
                <span class="method-badge">GET /statements</span>
            </h2>

            <form id="statementsForm">
                <div class="form-group">
                    <label for="query_type">æŸ¥è¯¢ç±»å‹</label>
                    <select id="query_type" name="query_type" required onchange="updateStatementsSymbol()">
                        <option value="a_financial_statements">Aè‚¡è´¢åŠ¡ä¸‰è¡¨</option>
                        <option value="hk_financial_statements">æ¸¯è‚¡è´¢åŠ¡ä¸‰è¡¨</option>
                        <option value="us_financial_statements">ç¾è‚¡è´¢åŠ¡ä¸‰è¡¨</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="symbol">è‚¡ç¥¨ä»£ç </label>
                    <input type="text" id="symbol" name="symbol" value="SH600519" placeholder="ä¾‹å¦‚: SH600519, 00700, AAPL" required>
                </div>

                <div class="form-group">
                    <label for="frequency">æ•°æ®é¢‘ç‡</label>
                    <select id="frequency" name="frequency" required>
                        <option value="annual">å¹´åº¦æ•°æ®</option>
                        <option value="quarterly">æŠ¥å‘ŠæœŸæ•°æ®</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="limit">è¿”å›è®°å½•æ•°ï¼ˆå¯é€‰ï¼‰</label>
                    <input type="number" id="limit" name="limit" min="1" placeholder="ç•™ç©ºè¿”å›å…¨éƒ¨">
                </div>

                <button type="submit" id="statementsSubmitBtn">ğŸ” æŸ¥è¯¢è´¢åŠ¡ä¸‰è¡¨</button>
            </form>

            <div class="url-display" id="statementsUrl">
                <strong>è¯·æ±‚ URLï¼š</strong><span id="statementsUrlText">-</span>
            </div>
        </div>

        <!-- å­—æ®µå‘ç° -->
        <div class="tab-content" id="contentFields" style="display: none;">
            <h2 style="margin-bottom: 20px; color: #333;">
                å­—æ®µå‘ç°æŸ¥è¯¢
                <span class="method-badge">GET /fields/{market}/{query_type}</span>
            </h2>

            <form id="fieldsForm">
                <div class="form-group">
                    <label for="fields_market">å¸‚åœºç±»å‹</label>
                    <select id="fields_market" name="market" required onchange="updateFieldsQueryType()">
                        <option value="a_stock">Aè‚¡</option>
                        <option value="hk_stock">æ¸¯è‚¡</option>
                        <option value="us_stock">ç¾è‚¡</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="fields_query_type">æŸ¥è¯¢ç±»å‹</label>
                    <select id="fields_query_type" name="query_type" required onchange="updateFieldsUrl()">
                        <option value="a_stock_indicators">Aè‚¡è´¢åŠ¡æŒ‡æ ‡</option>
                        <option value="a_financial_statements">Aè‚¡è´¢åŠ¡ä¸‰è¡¨</option>
                    </select>
                </div>

                <button type="submit" id="fieldsSubmitBtn">ğŸ” æŸ¥è¯¢å¯ç”¨å­—æ®µ</button>
            </form>

            <div class="url-display" id="fieldsUrl">
                <strong>è¯·æ±‚ URLï¼š</strong><span id="fieldsUrlText">-</span>
            </div>
        </div>

        <!-- åŠ è½½çŠ¶æ€ -->
        <div class="loading" id="loading" style="margin-top: 20px;">æ­£åœ¨æŸ¥è¯¢ä¸­ï¼Œè¯·ç¨å€™</div>

        <!-- ç»“æœå±•ç¤º -->
        <div class="result" id="result"></div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8000/api/v1/financial';

        // ========== Tab åˆ‡æ¢ ==========
        function switchTab(tab) {
            // éšè—æ‰€æœ‰å†…å®¹
            document.getElementById('contentIndicators').style.display = 'none';
            document.getElementById('contentStatements').style.display = 'none';
            document.getElementById('contentFields').style.display = 'none';

            // ç§»é™¤æ‰€æœ‰ Tab æ¿€æ´»çŠ¶æ€
            document.getElementById('tabIndicators').classList.remove('active');
            document.getElementById('tabStatements').classList.remove('active');
            document.getElementById('tabFields').classList.remove('active');

            // æ˜¾ç¤ºé€‰ä¸­çš„å†…å®¹å’Œæ¿€æ´» Tab
            document.getElementById('content' + tab.charAt(0).toUpperCase() + tab.slice(1)).style.display = 'block';
            document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.add('active');

            // éšè—ç»“æœ
            document.getElementById('result').style.display = 'none';
        }

        // ========== URL æ›´æ–°å‡½æ•° ==========
        function updateIndicatorsUrl() {
            const market = document.getElementById('indicators_market').value;
            const symbol = document.getElementById('indicators_symbol').value;
            const frequency = document.getElementById('indicators_frequency').value;

            const url = `${API_BASE_URL}/indicators?market=${market}&symbol=${encodeURIComponent(symbol)}&frequency=${frequency}`;
            document.getElementById('indicatorsUrlText').textContent = url;
        }

        function updateStatementsUrl() {
            const queryType = document.getElementById('query_type').value;
            const symbol = document.getElementById('symbol').value;
            const frequency = document.getElementById('frequency').value;
            const limit = document.getElementById('limit').value;

            let url = `${API_BASE_URL}/statements?query_type=${queryType}&symbol=${encodeURIComponent(symbol)}&frequency=${frequency}`;
            if (limit) {
                url += `&limit=${limit}`;
            }
            document.getElementById('statementsUrlText').textContent = url;
        }

        function updateFieldsUrl() {
            const market = document.getElementById('fields_market').value;
            const queryType = document.getElementById('fields_query_type').value;

            const url = `${API_BASE_URL}/fields/${market}/${queryType}`;
            document.getElementById('fieldsUrlText').textContent = url;
        }

        // ========== è‚¡ç¥¨ä»£ç æ›´æ–°å‡½æ•° ==========
        function updateIndicatorsSymbol() {
            const market = document.getElementById('indicators_market').value;
            const symbolInput = document.getElementById('indicators_symbol');

            switch(market) {
                case 'a_stock':
                    symbolInput.placeholder = 'ä¾‹å¦‚: SH600519, SZ000001';
                    symbolInput.value = 'SH600519';
                    break;
                case 'hk_stock':
                    symbolInput.placeholder = 'ä¾‹å¦‚: 00700, 00941';
                    symbolInput.value = '00700';
                    break;
                case 'us_stock':
                    symbolInput.placeholder = 'ä¾‹å¦‚: AAPL, MSFT';
                    symbolInput.value = 'AAPL';
                    break;
            }
            updateIndicatorsUrl();
        }

        function updateStatementsSymbol() {
            const queryType = document.getElementById('query_type').value;
            const symbolInput = document.getElementById('symbol');

            switch(queryType) {
                case 'a_financial_statements':
                    symbolInput.placeholder = 'ä¾‹å¦‚: SH600519, SZ000001';
                    symbolInput.value = 'SH600519';
                    break;
                case 'hk_financial_statements':
                    symbolInput.placeholder = 'ä¾‹å¦‚: 00700, 00941';
                    symbolInput.value = '00700';
                    break;
                case 'us_financial_statements':
                    symbolInput.placeholder = 'ä¾‹å¦‚: AAPL, MSFT';
                    symbolInput.value = 'AAPL';
                    break;
            }
            updateStatementsUrl();
        }

        function updateFieldsQueryType() {
            const market = document.getElementById('fields_market').value;
            const queryTypeSelect = document.getElementById('fields_query_type');

            // æ¸…ç©ºé€‰é¡¹
            queryTypeSelect.innerHTML = '';

            // æ ¹æ®å¸‚åœºæ·»åŠ é€‰é¡¹
            switch(market) {
                case 'a_stock':
                    queryTypeSelect.innerHTML = `
                        <option value="a_stock_indicators">Aè‚¡è´¢åŠ¡æŒ‡æ ‡</option>
                        <option value="a_financial_statements">Aè‚¡è´¢åŠ¡ä¸‰è¡¨</option>
                    `;
                    break;
                case 'hk_stock':
                    queryTypeSelect.innerHTML = `
                        <option value="hk_stock_indicators">æ¸¯è‚¡è´¢åŠ¡æŒ‡æ ‡</option>
                        <option value="hk_financial_statements">æ¸¯è‚¡è´¢åŠ¡ä¸‰è¡¨</option>
                    `;
                    break;
                case 'us_stock':
                    queryTypeSelect.innerHTML = `
                        <option value="us_stock_indicators">ç¾è‚¡è´¢åŠ¡æŒ‡æ ‡</option>
                        <option value="us_financial_statements">ç¾è‚¡è´¢åŠ¡ä¸‰è¡¨</option>
                    `;
                    break;
            }
            updateFieldsUrl();
        }

        // ========== è¡¨æ ¼æ¸²æŸ“å‡½æ•° ==========
        function renderTable(data) {
            // åˆ¤æ–­æ•°æ®ç±»å‹å¹¶æ¸²æŸ“è¡¨æ ¼
            if (data.data && data.data.records && Array.isArray(data.data.records)) {
                // è´¢åŠ¡æŒ‡æ ‡æ•°æ®
                const records = data.data.records;
                if (records.length === 0) {
                    return '<p class="no-data">æš‚æ— æ•°æ®</p>';
                }

                const columns = data.data.columns || Object.keys(records[0]);
                let table = '<div class="table-container"><table class="data-table"><thead><tr>';
                columns.forEach(col => {
                    table += `<th>${col}</th>`;
                });
                table += '</tr></thead><tbody>';

                records.forEach(row => {
                    table += '<tr>';
                    columns.forEach(col => {
                        table += `<td>${row[col] !== null && row[col] !== undefined ? row[col] : '-'}</td>`;
                    });
                    table += '</tr>';
                });

                table += '</tbody></table></div>';
                return table;
            } else if (data.data && (data.data.balance_sheet || data.data.income_statement || data.data.cash_flow)) {
                // è´¢åŠ¡ä¸‰è¡¨æ•°æ®
                let html = '';
                const statements = ['balance_sheet', 'income_statement', 'cash_flow'];
                const statementNames = {
                    'balance_sheet': 'èµ„äº§è´Ÿå€ºè¡¨',
                    'income_statement': 'åˆ©æ¶¦è¡¨',
                    'cash_flow': 'ç°é‡‘æµé‡è¡¨'
                };

                statements.forEach(stmt => {
                    const stmtData = data.data[stmt];
                    if (stmtData && stmtData.data && stmtData.data.length > 0) {
                        html += `<h4>${statementNames[stmt]} (${stmtData.record_count} æ¡è®°å½•)</h4>`;
                        html += '<div class="table-container"><table class="data-table"><thead><tr>';
                        stmtData.columns.forEach(col => {
                            html += `<th>${col}</th>`;
                        });
                        html += '</tr></thead><tbody>';

                        stmtData.data.forEach(row => {
                            html += '<tr>';
                            stmtData.columns.forEach(col => {
                                html += `<td>${row[col] !== null && row[col] !== undefined ? row[col] : '-'}</td>`;
                            });
                            html += '</tr>';
                        });

                        html += '</tbody></table></div>';
                    }
                });

                return html || '<p class="no-data">æš‚æ— æ•°æ®</p>';
            } else if (data.data && data.data.columns) {
                // å­—æ®µåˆ—è¡¨
                let table = '<div class="table-container"><table class="data-table"><thead><tr>';
                data.data.columns.forEach(col => {
                    table += `<th>${col}</th>`;
                });
                table += '</tr></thead><tbody><tr>';
                data.data.columns.forEach(col => {
                    table += `<td>${col}</td>`;
                });
                table += '</tr></tbody></table></div>';
                return table;
            }

            return '<p class="no-data">æ— æ³•è¯†åˆ«çš„æ•°æ®æ ¼å¼</p>';
        }

        // ========== äº‹ä»¶ç›‘å¬ ==========
        document.getElementById('indicators_market').addEventListener('change', updateIndicatorsUrl);
        document.getElementById('indicators_symbol').addEventListener('input', updateIndicatorsUrl);
        document.getElementById('indicators_frequency').addEventListener('change', updateIndicatorsUrl);

        document.getElementById('query_type').addEventListener('change', updateStatementsUrl);
        document.getElementById('symbol').addEventListener('input', updateStatementsUrl);
        document.getElementById('frequency').addEventListener('change', updateStatementsUrl);
        document.getElementById('limit').addEventListener('input', updateStatementsUrl);

        // ========== è´¢åŠ¡æŒ‡æ ‡æŸ¥è¯¢ ==========
        document.getElementById('indicatorsForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const submitBtn = document.getElementById('indicatorsSubmitBtn');
            const resultDiv = document.getElementById('result');
            const loadingDiv = document.getElementById('loading');

            const market = document.getElementById('indicators_market').value;
            const symbol = document.getElementById('indicators_symbol').value;
            const frequency = document.getElementById('indicators_frequency').value;

            // æ„å»ºæŸ¥è¯¢å‚æ•°
            const params = new URLSearchParams({
                market: market,
                symbol: symbol,
                frequency: frequency
            });

            submitBtn.disabled = true;
            loadingDiv.style.display = 'block';
            resultDiv.style.display = 'none';

            try {
                const response = await fetch(`${API_BASE_URL}/indicators?${params}`, {
                    method: 'GET'
                });

                const data = await response.json();

                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <h2>âœ… æŸ¥è¯¢æˆåŠŸ</h2>
                        <div class="metadata">
                            <h3>ğŸ“‹ æŸ¥è¯¢å…ƒæ•°æ®</h3>
                            <p><strong>è‚¡ç¥¨ä»£ç ï¼š</strong>${data.query_info.symbol || symbol}</p>
                            <p><strong>æŸ¥è¯¢ç±»å‹ï¼š</strong>${data.metadata.query_type}</p>
                            <p><strong>æ•°æ®é¢‘ç‡ï¼š</strong>${data.metadata.frequency}</p>
                            <p><strong>è®°å½•æ•°ï¼š</strong>${data.data.shape[0]}</p>
                            <p><strong>å­—æ®µæ•°ï¼š</strong>${data.data.shape[1]}</p>
                        </div>
                        <h3>ğŸ“Š æ•°æ®è¡¨æ ¼</h3>
                        ${renderTable(data)}
                        <details class="raw-data">
                            <summary>æŸ¥çœ‹å®Œæ•´JSONå“åº”</summary>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </details>
                    `;
                } else {
                    resultDiv.className = 'result error';
                    const errorMsg = data.detail?.error?.message || data.detail || JSON.stringify(data, null, 2);
                    resultDiv.innerHTML = `
                        <h2>âŒ æŸ¥è¯¢å¤±è´¥</h2>
                        <p><strong>é”™è¯¯ä¿¡æ¯ï¼š</strong></p>
                        <pre>${errorMsg}</pre>
                    `;
                }

                resultDiv.style.display = 'block';

            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <h2>âŒ ç½‘ç»œé”™è¯¯</h2>
                    <p><strong>é”™è¯¯ä¿¡æ¯ï¼š</strong>${error.message}</p>
                    <p>è¯·ç¡®ä¿APIæœåŠ¡å·²å¯åŠ¨ï¼ˆè¿è¡Œ <code>poe api</code>ï¼‰</p>
                `;
                resultDiv.style.display = 'block';
            } finally {
                submitBtn.disabled = false;
                loadingDiv.style.display = 'none';
            }
        });

        // ========== è´¢åŠ¡ä¸‰è¡¨æŸ¥è¯¢ ==========
        document.getElementById('statementsForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const submitBtn = document.getElementById('statementsSubmitBtn');
            const resultDiv = document.getElementById('result');
            const loadingDiv = document.getElementById('loading');

            const queryType = document.getElementById('query_type').value;
            const symbol = document.getElementById('symbol').value;
            const frequency = document.getElementById('frequency').value;
            const limit = document.getElementById('limit').value;

            // æ„å»ºæŸ¥è¯¢å‚æ•°
            const params = new URLSearchParams({
                query_type: queryType,
                symbol: symbol,
                frequency: frequency
            });
            if (limit) {
                params.append('limit', limit);
            }

            submitBtn.disabled = true;
            loadingDiv.style.display = 'block';
            resultDiv.style.display = 'none';

            try {
                const response = await fetch(`${API_BASE_URL}/statements?${params}`, {
                    method: 'GET'
                });

                const data = await response.json();

                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <h2>âœ… æŸ¥è¯¢æˆåŠŸ</h2>
                        <div class="metadata">
                            <h3>ğŸ“‹ æŸ¥è¯¢å…ƒæ•°æ®</h3>
                            <p><strong>è‚¡ç¥¨ä»£ç ï¼š</strong>${data.metadata.symbol}</p>
                            <p><strong>æŸ¥è¯¢ç±»å‹ï¼š</strong>${data.metadata.query_type}</p>
                            <p><strong>æ•°æ®é¢‘ç‡ï¼š</strong>${data.metadata.frequency}</p>
                            <p><strong>é™åˆ¶æ¡æ•°ï¼š</strong>${data.metadata.limit || 'æ— é™åˆ¶'}</p>
                            <h3>ğŸ“Š è®°å½•ç»Ÿè®¡</h3>
                            <p><strong>èµ„äº§è´Ÿå€ºè¡¨ï¼š</strong>${data.metadata.record_counts.balance_sheet} æ¡è®°å½•</p>
                            <p><strong>åˆ©æ¶¦è¡¨ï¼š</strong>${data.metadata.record_counts.income_statement} æ¡è®°å½•</p>
                            <p><strong>ç°é‡‘æµé‡è¡¨ï¼š</strong>${data.metadata.record_counts.cash_flow} æ¡è®°å½•</p>
                        </div>
                        <h3>ğŸ“Š æ•°æ®è¡¨æ ¼</h3>
                        ${renderTable(data)}
                        <details class="raw-data">
                            <summary>æŸ¥çœ‹å®Œæ•´JSONå“åº”</summary>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </details>
                    `;
                } else {
                    resultDiv.className = 'result error';
                    const errorMsg = data.detail?.error?.message || data.detail || JSON.stringify(data, null, 2);
                    resultDiv.innerHTML = `
                        <h2>âŒ æŸ¥è¯¢å¤±è´¥</h2>
                        <p><strong>é”™è¯¯ä¿¡æ¯ï¼š</strong></p>
                        <pre>${errorMsg}</pre>
                    `;
                }

                resultDiv.style.display = 'block';

            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <h2>âŒ ç½‘ç»œé”™è¯¯</h2>
                    <p><strong>é”™è¯¯ä¿¡æ¯ï¼š</strong>${error.message}</p>
                    <p>è¯·ç¡®ä¿APIæœåŠ¡å·²å¯åŠ¨ï¼ˆè¿è¡Œ <code>poe api</code>ï¼‰</p>
                `;
                resultDiv.style.display = 'block';
            } finally {
                submitBtn.disabled = false;
                loadingDiv.style.display = 'none';
            }
        });

        // ========== å­—æ®µå‘ç°æŸ¥è¯¢ ==========
        document.getElementById('fieldsForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const submitBtn = document.getElementById('fieldsSubmitBtn');
            const resultDiv = document.getElementById('result');
            const loadingDiv = document.getElementById('loading');

            const market = document.getElementById('fields_market').value;
            const queryType = document.getElementById('fields_query_type').value;

            submitBtn.disabled = true;
            loadingDiv.style.display = 'block';
            resultDiv.style.display = 'none';

            try {
                const response = await fetch(`${API_BASE_URL}/fields/${market}/${queryType}`, {
                    method: 'GET'
                });

                const data = await response.json();

                if (response.ok) {
                    const isIndicators = queryType.includes('indicators');

                    let html = `
                        <h2>âœ… å­—æ®µå‘ç°æˆåŠŸ</h2>
                        <div class="metadata">
                            <h3>ğŸ“‹ æŸ¥è¯¢ä¿¡æ¯</h3>
                            <p><strong>å¸‚åœºï¼š</strong>${data.metadata.market}</p>
                            <p><strong>æŸ¥è¯¢ç±»å‹ï¼š</strong>${data.metadata.query_type}</p>
                    `;

                    if (isIndicators) {
                        html += `
                            <p><strong>å­—æ®µæ•°é‡ï¼š</strong>${data.metadata.field_count}</p>
                        </div>
                        <h3>ğŸ“Š å¯ç”¨å­—æ®µåˆ—è¡¨</h3>
                        ${renderTable(data)}
                    `;
                    } else {
                        html += `
                            <p><strong>æ ·æœ¬è‚¡ç¥¨ï¼š</strong>${data.metadata.sample_symbol}</p>
                        </div>
                        <h3>ğŸ“Š å¯ç”¨å­—æ®µåˆ—è¡¨</h3>
                        <h4>èµ„äº§è´Ÿå€ºè¡¨ (${data.data.balance_sheet.field_count} ä¸ªå­—æ®µ)</h4>
                        ${renderTable({data: {balance_sheet: data.data.balance_sheet}})}
                        <h4 style="margin-top: 15px;">åˆ©æ¶¦è¡¨ (${data.data.income_statement.field_count} ä¸ªå­—æ®µ)</h4>
                        ${renderTable({data: {income_statement: data.data.income_statement}})}
                        <h4 style="margin-top: 15px;">ç°é‡‘æµé‡è¡¨ (${data.data.cash_flow.field_count} ä¸ªå­—æ®µ)</h4>
                        ${renderTable({data: {cash_flow: data.data.cash_flow}})}
                    `;
                    }

                    html += `
                        <details class="raw-data">
                            <summary>æŸ¥çœ‹å®Œæ•´JSONå“åº”</summary>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </details>
                    `;

                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.className = 'result error';
                    const errorMsg = data.detail?.error?.message || data.detail || JSON.stringify(data, null, 2);
                    resultDiv.innerHTML = `
                        <h2>âŒ æŸ¥è¯¢å¤±è´¥</h2>
                        <p><strong>é”™è¯¯ä¿¡æ¯ï¼š</strong></p>
                        <pre>${errorMsg}</pre>
                    `;
                }

                resultDiv.style.display = 'block';

            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <h2>âŒ ç½‘ç»œé”™è¯¯</h2>
                    <p><strong>é”™è¯¯ä¿¡æ¯ï¼š</strong>${error.message}</p>
                    <p>è¯·ç¡®ä¿APIæœåŠ¡å·²å¯åŠ¨ï¼ˆè¿è¡Œ <code>poe api</code>ï¼‰</p>
                `;
                resultDiv.style.display = 'block';
            } finally {
                submitBtn.disabled = false;
                loadingDiv.style.display = 'none';
            }
        });

        // ========== åˆå§‹åŒ– ==========
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ– URL æ˜¾ç¤º
        updateIndicatorsUrl();
        updateStatementsUrl();
        updateFieldsUrl();
    </script>
</body>
</html>
