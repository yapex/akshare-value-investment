"""
市场配置 - 不同市场的字段映射
"""

from typing import Dict, List
from .base_models import MarketType


# A股字段配置（基于FastAPI字段发现API验证）
A_STOCK_FIELDS = {
    "balance_sheet": {
        "报告期": "报告期",
        "货币资金": "货币资金",
        "拆出资金": "拆出资金",
        "交易性金融资产": "交易性金融资产",
        "应收票据及应收账款": "应收票据及应收账款",
        "其中：应收票据": "其中：应收票据",
        "应收账款": "应收账款",
        "预付款项": "预付款项",
        "其他应收款合计": "其他应收款合计",
        "其中：应收利息": "其中：应收利息",
        "其他应收款": "其他应收款",
        "存货": "存货",
        "一年内到期的非流动资产": "一年内到期的非流动资产",
        "其他流动资产": "其他流动资产",
        "总现金": "总现金",
        "流动资产合计": "流动资产合计",
        "非流动资产": "非流动资产",
        "可供出售金融资产": "可供出售金融资产",
        "持有至到期投资": "持有至到期投资",
        "长期股权投资": "长期股权投资",
        "其他非流动金融资产": "其他非流动金融资产",
        "投资性房地产": "投资性房地产",
        "固定资产合计": "固定资产合计",
        "其中：固定资产": "其中：固定资产",
        "固定资产清理": "固定资产清理",
        "在建工程合计": "在建工程合计",
        "其中：在建工程": "其中：在建工程",
        "工程物资": "工程物资",
        "无形资产": "无形资产",
        "长期待摊费用": "长期待摊费用",
        "递延所得税资产": "递延所得税资产",
        "其他非流动资产": "其他非流动资产",
        "非流动资产合计": "非流动资产合计",
        "*资产合计": "*资产合计",
        "流动负债": "流动负债",
        "短期借款": "短期借款",
        "应付票据及应付账款": "应付票据及应付账款",
        "应付账款": "应付账款",
        "预收款项": "预收款项",
        "合同负债": "合同负债",
        "应付职工薪酬": "应付职工薪酬",
        "应交税费": "应交税费",
        "其他应付款合计": "其他应付款合计",
        "其中：应付利息": "其中：应付利息",
        "应付股利": "应付股利",
        "其他应付款": "其他应付款",
        "一年内到期的非流动负债": "一年内到期的非流动负债",
        "其他流动负债": "其他流动负债",
        "流动负债合计": "流动负债合计",
        "非流动负债": "非流动负债",
        "长期借款": "长期借款",
        "长期应付款合计": "长期应付款合计",
        "其中：长期应付款": "其中：长期应付款",
        "专项应付款": "专项应付款",
        "递延所得税负债": "递延所得税负债",
        "非流动负债合计": "非流动负债合计",
        "*负债合计": "*负债合计",
        "所有者权益（或股东权益）": "所有者权益（或股东权益）",
        "实收资本（或股本）": "实收资本（或股本）",
        "资本公积": "资本公积",
        "减：库存股": "减：库存股",
        "其他综合收益": "其他综合收益",
        "盈余公积": "盈余公积",
        "未分配利润": "未分配利润",
        "归属于母公司所有者权益合计": "归属于母公司所有者权益合计",
        "少数股东权益": "少数股东权益",
        "所有者权益（或股东权益）合计": "所有者权益（或股东权益）合计",
        "负债和所有者权益（或股东权益）合计": "负债和所有者权益（或股东权益）合计"
    },
    "income_statement": {
        "报告期": "报告期",
        "报表核心指标": "报表核心指标",
        "*净利润": "*净利润",
        "*营业总收入": "*营业总收入",
        "*营业总成本": "*营业总成本",
        "*归属于母公司所有者的净利润": "*归属于母公司所有者的净利润",
        "*扣除非经常性损益后的净利润": "*扣除非经常性损益后的净利润",
        "报表全部指标": "报表全部指标",
        "一、营业总收入": "一、营业总收入",
        "其中：营业收入": "其中：营业收入",
        "二、营业总成本": "二、营业总成本",
        "其中：营业成本": "其中：营业成本",
        "营业税金及附加": "营业税金及附加",
        "销售费用": "销售费用",
        "管理费用": "管理费用",
        "研发费用": "研发费用",
        "财务费用": "财务费用",
        "其中：利息费用": "其中：利息费用",
        "利息收入": "利息收入",
        "资产减值损失": "资产减值损失",
        "信用减值损失": "信用减值损失",
        "加：公允价值变动收益": "加：公允价值变动收益",
        "投资收益": "投资收益",
        "资产处置收益": "资产处置收益",
        "其他收益": "其他收益",
        "三、营业利润": "三、营业利润",
        "加：营业外收入": "加：营业外收入",
        "其中：非流动资产处置利得": "其中：非流动资产处置利得",
        "减：营业外支出": "减：营业外支出",
        "其中：非流动资产处置损失": "其中：非流动资产处置损失",
        "四、利润总额": "四、利润总额",
        "净利润差额(合计平衡项目)": "净利润差额(合计平衡项目)",
        "减：所得税费用": "减：所得税费用",
        "五、净利润": "五、净利润",
        "（一）持续经营净利润": "（一）持续经营净利润",
        "归属于母公司所有者的净利润": "归属于母公司所有者的净利润",
        "少数股东损益": "少数股东损益",
        "扣除非经常性损益后的净利润": "扣除非经常性损益后的净利润",
        "六、每股收益": "六、每股收益",
        "（一）基本每股收益": "（一）基本每股收益",
        "（二）稀释每股收益": "（二）稀释每股收益",
        "七、其他综合收益": "七、其他综合收益",
        "归属母公司所有者的其他综合收益": "归属母公司所有者的其他综合收益",
        "八、综合收益总额": "八、综合收益总额",
        "归属于母公司股东的综合收益总额": "归属于母公司股东的综合收益总额",
        "归属于少数股东的综合收益总额": "归属于少数股东的综合收益总额"
    },
    "cash_flow": {
        "报告期": "报告期",
        "经营活动产生的现金流量净额": "经营活动产生的现金流量净额",
        "投资活动产生的现金流量净额": "投资活动产生的现金流量净额",
        "筹资活动产生的现金流量净额": "筹资活动产生的现金流量净额"
    }
}

# 港股字段配置（TODO: 待完善）
HK_STOCK_FIELDS = {
    "balance_sheet": {
        # TODO: 港股字段映射
    },
    "income_statement": {
        # TODO: 港股字段映射
    },
    "cash_flow": {
        # TODO: 港股字段映射
    }
}

# 美股字段配置（TODO: 待完善）
US_STOCK_FIELDS = {
    "balance_sheet": {
        # TODO: 美股字段映射
    },
    "income_statement": {
        # TODO: 美股字段映射
    },
    "cash_flow": {
        # TODO: 美股字段映射
    }
}

# 市场配置映射
MARKET_CONFIGS = {
    MarketType.A_STOCK: A_STOCK_FIELDS,
    MarketType.HK_STOCK: HK_STOCK_FIELDS,
    MarketType.US_STOCK: US_STOCK_FIELDS
}


def get_market_fields(market: MarketType, query_type: str) -> Dict[str, str]:
    """获取指定市场和查询类型的字段映射

    Args:
        market: 市场类型
        query_type: 查询类型 (balance_sheet, income_statement, cash_flow)

    Returns:
        字段映射字典
    """
    config = MARKET_CONFIGS.get(market, {})
    return config.get(query_type, {})


def get_all_market_configs() -> Dict[MarketType, Dict[str, Dict[str, str]]]:
    """获取所有市场的配置

    Returns:
        所有市场配置字典
    """
    return MARKET_CONFIGS.copy()


def get_required_fields_for_market(market: MarketType, query_type: str) -> List[str]:
    """获取指定市场和查询类型的所有字段列表

    Args:
        market: 市场类型
        query_type: 查询类型

    Returns:
        字段列表
    """
    fields_config = get_market_fields(market, query_type)
    return list(fields_config.values()) if fields_config else []